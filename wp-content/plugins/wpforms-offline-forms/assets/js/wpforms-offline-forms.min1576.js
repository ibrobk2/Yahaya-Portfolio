"use strict";var WPFormsOfflineForms=window.WPFormsOfflineForms||function(i,e,f){var n={isOffline:!1,forms:[],formsData:{},storage:{local:store.namespace("wpforms").namespace("offline"),expire:86400,set:function(e,t){var i=this.local.namespace(parseInt(e,10));i.set(i.size()+1,t,this.expire)},get:function(e){e=parseInt(e,10);var t=this.getAll(e),i={};return 0<t.length&&(i=t.shift()),this.local.namespace(e).remove(i.entry_id),i},getAll:function(e){var t,i=this.local.namespace(parseInt(e,10)).getAll(),o=[];for(t in i)i.hasOwnProperty(t)&&!f.isEmptyObject(i[t])&&o.push({entry_id:t,entry:i[t]});return o},clearAll:function(e){this.local.namespace(parseInt(e,10)).clearAll()}},notifications:{$_form:!1,_actions:[],setForm:function(e){return this.$_form=e,this._clearActions(),this},setActions:function(e){if(!e)return this._clearActions(),this;var t;for(t in e)e.hasOwnProperty(t)&&this._actions.push({key:t,label:e[t]});return this},_clearActions:function(){this._actions=[]},_getNotificationTemplate:function(){return f('<div class="wpforms-notice wpforms-info"></div>')},_getActionsTemplate:function(){return f('<div class="wpforms-notice-actions"></div>')},_getActionTemplate:function(){return f('<a class="wpforms-notice-action"></a>')},display:function(e,t){var i="non-dismissible";t&&(i="");var o=this._getNotificationTemplate().addClass(i).html(e);if(this._actions.length){var n,s=this._getActionsTemplate();for(n in this._actions)s.append(this._getActionTemplate().attr("href","#"+encodeURIComponent(this._actions[n].key)).text(this._actions[n].label));o.append(s)}f(".wpforms-field-container",this.$_form).before(o);var r=this.$_form;f("html, body").animate({scrollTop:r.offset().top-100},750)},hide:function(){f(".wpforms-notice",this.$_form).not(".non-dismissible").remove()},hideAll:function(){f(".wpforms-notice",this.$_form).remove()}},init:function(){n.populateForms(),e.addEventListener("online",n.connectionEvent),e.addEventListener("offline",n.connectionEvent),f(i).on("wpformsReady",n.checkConnectivityLoop),f(i).on("wpformsReady",n.checkOfflineRecords),f(i).on("wpformsReady",n.saveFormDefaults),n.bindUIActions()},populateForms:function(){f.each(wpforms_offline_forms.offline_form_ids,function(e,t){n.forms.push(f("#wpforms-"+t))})},checkConnectivityLoop:function(){var e=parseInt(wpforms_offline_forms.check_connection_interval,10);n._isNaturalNumber(e)&&setInterval(function(){n.processConnectivityAjaxCheck(null)},1e3*e)},processConnectivityAjaxCheck:function(i){var e=parseInt(wpforms_offline_forms.check_connection_timeout,10);n._isNaturalNumber(e)&&f.ajax({method:"HEAD",url:wpforms_offline_forms.check_connection_url,cache:!1,timeout:1e3*e,complete:function(e,t){0!==e.status&&"timeout"!==t?(n.isOffline=!1,n.notificationOfflineHide()):(n.isOffline=!0,n.notificationOfflineDisplay()),"function"==typeof i&&i()}})},checkOfflineRecords:function(){f.each(n.forms,function(e,t){var i=n.storage.getAll(t.find("form").data("formid")),o=n.notifications.setForm(t);o.hideAll(),0!==i.length&&(1===i.length?(n.isOffline||o.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_btn}),o.display(wpforms_offline_forms.text_restore_single)):(n.isOffline||o.setActions({offline_restore:wpforms_offline_forms.text_restore_btn,offline_clear:wpforms_offline_forms.text_clear_all_btn}),o.display(wpforms_offline_forms.text_restore_plural)))})},saveFormDefaults:function(){f.each(wpforms_offline_forms.offline_form_ids,function(e,t){n.formsData[t]=f("#wpforms-"+t).find("form").serializeArray()})},processRestoreFormDefault:function(e){var t=f("#wpforms-"+e);if(void 0!==n.formsData[e]&&t.length){if(t.find("form").deserialize(n.formsData[e],{change:n.deserializeChangeCallback}),t.find(".wpforms-page-indicator").length)if(t.find('.wpforms-page-prev[data-page="2"]').length)t.find(".wpforms-page").hide(),t.find('.wpforms-page-prev[data-page="2"]').trigger("click");else{var i=f('<button class="wpforms-page-button wpforms-page-prev"></button>');i.css("visibility","hidden").data("action","prev").data("page","2").data("formid",e),t.find(".wpforms-page").hide(),t.find(".wpforms-field-pagebreak").first().append(i),i.trigger("click"),i.remove()}this.checkOfflineRecords()}},deserializeChangeCallback:function(e){var t=f(this),i=t.closest(".wpforms-field");if(i.hasClass("wpforms-field-phone")&&void 0!==f.fn.intlTelInput){var o=i.find(".wpforms-smart-phone-field");0<o.length&&o.intlTelInput("setNumber",e)}t.trigger("change")},bindUIActions:function(){var s=this;f.each(n.forms,function(e,t){s.processFormSave(t.find("form"))}),f.each(n.forms,function(e,t){f(i).on("click","#"+t.attr("id")+' .wpforms-submit-container button[type="submit"]',function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=f(this),i=t.data("alt-text"),o=f(this).closest("form"),n=t.text();t.prop("disabled")||(t.prop("disabled",!0),i&&t.text(i),s.processConnectivityAjaxCheck(function(){t.prop("disabled",!1),t.text(n),o.submit()}))})}),f(i).on("click",'.wpforms-notice-action[href="#offline_restore"]',function(e){e.preventDefault(),s.processRestore(f(this).closest("form"))}),f(i).on("click",'.wpforms-notice-action[href="#offline_clear"]',function(e){e.preventDefault(),s.processClearAll(f(this).closest("form"))})},processFormSave:function(o){o.submit(function(e){if(!n.isOffline)return!0;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();var t=parseInt(o.data("formid"),10);f(".wpforms-field",o).each(function(e,t){(f(t).hasClass("wpforms-field-password")||f(t).hasClass("wpforms-field-credit-card")||f(t).hasClass("wpforms-field-signature"))&&f(t).find("input, select").attr("disabled","disabled")});var i=o.serializeArray();f(".wpforms-field",o).each(function(e,t){(f(t).hasClass("wpforms-field-password")||f(t).hasClass("wpforms-field-credit-card")||f(t).hasClass("wpforms-field-signature"))&&f(t).find("input, select").removeAttr("disabled")}),n.storage.set(t,i),n.processRestoreFormDefault(t)})},processRestore:function(e){var t=this.storage.get(e.data("formid"));e.deserialize(t.entry,{change:n.deserializeChangeCallback}),this.checkOfflineRecords()},processClearAll:function(e){this.storage.clearAll(e.data("formid")),this.notifications.setForm(e).hideAll()},connectionEvent:function(){n.connectionUpdateStatus()},connectionUpdateStatus:function(){void 0!==navigator.onLine&&(n.isOffline=!navigator.onLine,f("body").toggleClass("wpforms-is-offline",n.isOffline),n.isOffline?n.notificationOfflineDisplay():n.notificationOfflineHide())},notificationOfflineDisplay:function(){f.each(n.forms,function(e,t){var i=n.notifications.setForm(t);i.hideAll(),i.display(wpforms_offline_forms.text_offline,!0)})},notificationOfflineHide:function(e){this.notifications.setForm(e).hide(),this.checkOfflineRecords()},_isNaturalNumber:function(e){return 0<=e&&Math.floor(e)===+e}};return n}(document,window,jQuery);WPFormsOfflineForms.init();